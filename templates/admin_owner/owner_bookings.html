{% include 'admin_owner/sidebar.html' %}
{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>My Restaurant Bookings</title>

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f4f6f9;
            margin: 0;
            padding: 0;
            display: flex; /* Flex container for sidebar + main content */
            min-height: 100vh;
        }

        .content-wrapper {
            flex-grow: 1; /* Allows it to fill the available space next to sidebar */
            padding: 20px;
            margin-left: 250px; /* Adjust based on your sidebar width */
            display: flex;
            flex-direction: column;
            align-items: center; /* Center items horizontally within the wrapper */
        }

        h2 {
            color: #34495e;
            margin-bottom: 25px;
            font-weight: 700;
            text-align: center;
        }

        /* Search Bar Styling */
        .search-container {
            width: 100%;
            max-width: 600px; /* Adjust as needed */
            margin-bottom: 25px;
            display: flex;
            gap: 10px; /* Space between input and button */
            justify-content: center; /* Center the search bar */
        }

        .search-container input[type="text"] {
            flex-grow: 1;
            padding: 12px 18px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .search-container input[type="text"]:focus {
            border-color: #f97316;
            box-shadow: 0 0 0 3px rgba(249, 115, 22, 0.2);
            outline: none;
        }

        .search-container button {
            padding: 12px 20px;
            background-color: #f97316;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: background-color 0.3s ease, transform 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .search-container button:hover {
            background-color: #e06611;
            transform: translateY(-1px);
        }

        .search-container button i {
            font-size: 1.1em;
        }

        table {
            width: 100%;
            max-width: 1400px; /* Consistent max-width for tables */
            border-collapse: collapse;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            background-color: white;
            border-radius: 8px;
            overflow: hidden;
            margin: 0 auto; /* Center the table */
        }

        th, td {
            padding: 15px 12px;
            border-bottom: 1px solid #eee;
            vertical-align: middle;
            text-align: center; /* Default to center for all cells */
        }

        th {
            background-color: #f97316; /* Primary Orange Header */
            color: white;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-size: 0.85rem;
            font-weight: 600;
        }

        /* Left-align specific data cells for better readability */
        td:nth-child(3), /* Restaurant Name */
        td:nth-child(4), /* Customer Name */
        td:nth-child(6) /* Address */
        {
            text-align: left;
        }

        tr:nth-child(even) {
            background-color: #fcfcfc;
        }

        tr:hover {
            background-color: #ffe6d5;
        }

        /* Checkbox styling */
        .checkbox-container {
            display: block;
            position: relative;
            padding-left: 30px;
            margin-bottom: 0;
            cursor: pointer;
            font-size: 1em;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            text-align: center; /* Center the checkbox itself */
            min-height: 20px;
        }

        .checkbox-container input {
            position: absolute;
            opacity: 0;
            cursor: pointer;
            height: 0;
            width: 0;
        }

        .checkmark {
            position: absolute;
            top: 0;
            left: 50%; /* Center the checkmark */
            transform: translateX(-50%); /* Adjust for perfect centering */
            height: 20px;
            width: 20px;
            background-color: #eee;
            border-radius: 4px;
            border: 1px solid #ccc;
        }

        .checkbox-container:hover input ~ .checkmark {
            background-color: #ccc;
        }

        .checkbox-container input:checked ~ .checkmark {
            background-color: #f97316;
            border-color: #f97316;
        }

        .checkmark:after {
            content: "";
            position: absolute;
            display: none;
        }

        .checkbox-container input:checked ~ .checkmark:after {
            display: block;
        }

        .checkbox-container .checkmark:after {
            left: 7px;
            top: 3px;
            width: 5px;
            height: 10px;
            border: solid white;
            border-width: 0 3px 3px 0;
            -webkit-transform: rotate(45deg);
            -ms-transform: rotate(45deg);
            transform: rotate(45deg);
        }
    </style>
</head>
<body>

    <div class="content-wrapper">
        <h2>My Restaurant Bookings</h2>

        <div class="search-container">
            <input type="text" id="searchInput" onkeyup="filterTable()" placeholder="Search by restaurant or customer name...">
            <button onclick="filterTable()"><i class="fas fa-search"></i> Search</button>
        </div>

        {% if bookings %}
        <table id="bookingsTable">
            <thead>
                <tr>
                    <th>
                        <label class="checkbox-container">
                            <input type="checkbox" id="selectAllCheckboxes">
                            <span class="checkmark"></span>
                        </label>
                    </th>
                    <th>#</th>
                    <th>Restaurant</th>
                    <th>Customer Name</th>
                    <th>Contact Number</th>
                    <th>Address</th>
                    <th>Members</th>
                    <th>Booking Time</th>
                </tr>
            </thead>
            <tbody>
                {% for booking in bookings %}
                <tr>
                    <td>
                        <label class="checkbox-container">
                            <input type="checkbox" class="row-checkbox" value="{{ booking.id }}">
                            <span class="checkmark"></span>
                        </label>
                    </td>
                    <td>{{ forloop.counter }}</td>
                    <td>{{ booking.restaurant.name }}</td>
                    <td>{{ booking.customer_name }}</td>
                    <td>{{ booking.contact_number }}</td>
                    <td>{{ booking.address }}</td>
                    <td>{{ booking.members }}</td>
                    <td>{{ booking.booking_time|date:"d M Y H:i" }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p class="text-center text-muted">No bookings yet for your restaurant.</p>
        {% endif %}
    </div>

    <script>
        function filterTable() {
            var input, filter, table, tr, tdRestaurant, tdCustomer, i, txtValueRestaurant, txtValueCustomer;
            input = document.getElementById("searchInput");
            filter = input.value.toUpperCase();
            table = document.getElementById("bookingsTable");
            tr = table.getElementsByTagName("tr");

            for (i = 0; i < tr.length; i++) {
                if (tr[i].getElementsByTagName("th").length > 0) { // Skip header row
                    continue;
                }

                tdRestaurant = tr[i].getElementsByTagName("td")[2]; // Restaurant Name column (index 2 after checkbox and #)
                tdCustomer = tr[i].getElementsByTagName("td")[3];   // Customer Name column (index 3 after checkbox and #)

                if (tdRestaurant || tdCustomer) {
                    txtValueRestaurant = tdRestaurant ? tdRestaurant.textContent || tdRestaurant.innerText : "";
                    txtValueCustomer = tdCustomer ? tdCustomer.textContent || tdCustomer.innerText : "";

                    if (txtValueRestaurant.toUpperCase().indexOf(filter) > -1 || txtValueCustomer.toUpperCase().indexOf(filter) > -1) {
                        tr[i].style.display = "";
                    } else {
                        tr[i].style.display = "none";
                    }
                }
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            const selectAllCheckbox = document.getElementById('selectAllCheckboxes');
            const rowCheckboxes = document.querySelectorAll('.row-checkbox');

            selectAllCheckbox.addEventListener('change', function() {
                rowCheckboxes.forEach(checkbox => {
                    checkbox.checked = this.checked;
                });
            });

            rowCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    if (!this.checked) {
                        selectAllCheckbox.checked = false;
                    } else {
                        // Check if all other visible checkboxes are checked
                        let allChecked = true;
                        document.querySelectorAll('#bookingsTable tbody tr').forEach(row => {
                            if (row.style.display !== 'none') { // Only consider visible rows
                                const rowCheckbox = row.querySelector('.row-checkbox');
                                if (rowCheckbox && !rowCheckbox.checked) {
                                    allChecked = false;
                                }
                            }
                        });
                        selectAllCheckbox.checked = allChecked;
                    }
                });
            });

            // Re-evaluate selectAll checkbox state after filtering
            document.getElementById('searchInput').addEventListener('keyup', function() {
                let allVisibleChecked = true;
                let anyVisibleRows = false;
                document.querySelectorAll('#bookingsTable tbody tr').forEach(row => {
                    if (row.style.display !== 'none') {
                        anyVisibleRows = true;
                        const rowCheckbox = row.querySelector('.row-checkbox');
                        if (rowCheckbox && !rowCheckbox.checked) {
                            allVisibleChecked = false;
                        }
                    }
                });
                selectAllCheckbox.checked = anyVisibleRows && allVisibleChecked;
            });
        });
    </script>

</body>
</html>