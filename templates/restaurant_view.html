{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Our Restaurants | Book a Table</title>
  
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  
  <!-- Font Awesome Icons -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Lato:wght@400;700&display=swap" rel="stylesheet">

  <style>
    /* --- 1. General Body & Typography --- */
    body {
      font-family: 'Lato', Arial, sans-serif;
      background-color: #f8f9fa; /* Light grey background for contrast */
      color: #333;
    }

    h1, h2, h3, h4, h5, h6, .card-title {
      font-family: 'Poppins', sans-serif;
    }

    /* --- 2. Hero Section --- */
    .hero-section {
      background: linear-gradient(135deg, rgba(0, 121, 107, 0.9), rgba(0, 77, 64, 0.95));
      color: white;
      padding: 4rem 1rem;
      text-align: center;
      margin-bottom: 3rem;
    }
    .hero-section h2 {
      font-size: 2.8rem;
      font-weight: 700;
      text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
    }
    .hero-section p {
      font-size: 1.1rem;
      max-width: 600px;
      margin: 0.5rem auto 0;
      opacity: 0.9;
    }


    /* --- 3. Card Styling & Animation --- */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .card {
      border: none;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 4px 15px rgba(0,0,0,0.08);
      transition: all 0.3s ease-in-out;
      animation: fadeInUp 0.5s ease-out forwards;
      opacity: 0; /* Start hidden for animation */
    }

    .card:hover {
      transform: translateY(-10px);
      box-shadow: 0 10px 30px rgba(0,0,0,0.15);
    }

    .card-img-container {
      overflow: hidden;
      height: 220px;
    }

    .restaurant-img {
      height: 100%;
      width: 100%;
      object-fit: cover;
      transition: transform 0.4s ease;
    }

    .card:hover .restaurant-img {
      transform: scale(1.05);
    }

    .card-title {
      color: #004d40; /* Dark Teal */
      font-weight: 600;
    }

    .card-body {
      padding: 1.5rem;
    }

    .card-details {
      list-style: none;
      padding-left: 0;
      font-size: 0.95rem;
      color: #555;
    }
    .card-details li {
      margin-bottom: 0.75rem;
      display: flex;
      align-items: center;
    }
    .card-details i {
      color: #00796b; /* Primary Teal */
      margin-right: 12px;
      width: 20px;
      text-align: center;
    }
    .available-seats-badge {
        padding: 0.25em 0.6em;
        font-size: 0.9em;
        font-weight: 700;
        border-radius: 5px;
        color: #1a5e2d;
        background-color: #dcedc8;
    }
    .fully-booked-badge {
        padding: 0.25em 0.6em;
        font-size: 0.9em;
        font-weight: 700;
        border-radius: 5px;
        color: #b71c1c;
        background-color: #ffcdd2;
    }

    /* --- 4. Button Styles --- */
    .btn {
      border-radius: 8px;
      padding: 0.6rem 1rem;
      font-weight: 600;
      transition: all 0.2s ease;
    }
    .btn-success {
      background-color: #00796b; /* Primary Teal */
      border-color: #00796b;
    }
    .btn-success:hover {
      background-color: #004d40; /* Darker Teal */
      border-color: #004d40;
      transform: translateY(-2px);
    }
    .btn-warning {
        background-color: #ffc107;
        border-color: #ffc107;
        color: #333;
    }
    .btn-warning:hover {
        background-color: #ffa000;
        border-color: #ffa000;
        transform: translateY(-2px);
    }
    .btn-outline-primary {
      color: #00796b;
      border-color: #00796b;
    }
    .btn-outline-primary:hover {
      background-color: #00796b;
      color: white;
    }
    .btn-secondary {
      cursor: not-allowed;
      opacity: 0.7;
    }

    /* --- 5. Modal Styling --- */
    .modal-content {
      border-radius: 15px;
      border: none;
    }
    .modal-header {
      border-bottom: 1px solid #eee;
    }
    .modal-header .btn-close {
        filter: invert(1) grayscale(100%) brightness(200%);
    }
    .modal-header.bg-danger .btn-close, .modal-header.bg-warning .btn-close {
        filter: none;
    }
    .modal-body img, .modal-body iframe {
      width: 100%;
      height: 75vh;
      border-radius: 8px;
      border: none;
    }

    @media (max-width: 768px) {
      .modal-body img, .modal-body iframe {
        height: 60vh;
      }
      .hero-section h2 {
          font-size: 2.2rem;
      }
    }
  </style>
</head>
<body>
  {% include 'header.html' %}

  <div class="content">
    
    <div class="hero-section">
      <div class="container">
        <h2>Find Your Perfect Table</h2>
        <p>Explore our curated selection of top-rated restaurants and book your next dining experience with ease.</p>
      </div>
    </div>

    <div class="container mt-5">
      <div class="row">
        {% for restaurant in restaurants %}
        <div class="col-lg-4 col-md-6 col-sm-12 mb-4 d-flex align-items-stretch">
          <div class="card w-100" style="--animation-order: {{ forloop.counter0 }};">

            <!-- Restaurant Image with Hover Effect Container -->
            <div class="card-img-container">
              {% if restaurant.image %}
              <img src="{{ restaurant.image.url }}" class="restaurant-img" alt="{{ restaurant.name }}">
              {% else %}
              <img src="https://via.placeholder.com/400x220?text=Restaurant" class="restaurant-img" alt="Default Image">
              {% endif %}
            </div>

            <div class="card-body d-flex flex-column">
              <h5 class="card-title text-center mb-3">{{ restaurant.name }}</h5>

              <!-- Restaurant Details with Icons -->
              <ul class="card-details flex-grow-1">
                <li><i class="fas fa-users"></i> <strong>Capacity:</strong>&nbsp;{{ restaurant.seating_capacity }}</li>
                <li>
                  <i class="fas fa-chair"></i> <strong>Available:</strong>&nbsp;
                  {% if restaurant.available_seats == 0 %}
                    <span class="fully-booked-badge">Fully Booked</span>
                  {% else %}
                    <span class="available-seats-badge">{{ restaurant.available_seats }} seats left</span>
                  {% endif %}
                </li>
                <li><i class="fas fa-clock"></i> <strong>Hours:</strong>&nbsp;{{ restaurant.opening_time|time:"h:i A" }} - {{ restaurant.closing_time|time:"h:i A" }}</li>
                <li><i class="fas fa-map-marker-alt"></i> {{ restaurant.address }}</li>
              </ul>

              <!-- Action Buttons -->
              <div class="d-flex gap-2 mt-auto pt-3">
                {% if restaurant.available_seats == 0 %}
                  <button class="btn btn-secondary flex-fill" onclick="showFullAlert('{{ restaurant.name }}')">
                    <i class="fas fa-ban"></i> Fully Booked
                  </button>
                {% else %}
                  {% if request.session.user_id %}
                      <a href="{% url 'book_table' restaurant.id %}" class="btn btn-success flex-fill">
                          <i class="fas fa-calendar-check"></i> Book Table
                      </a>
                  {% else %}
                      <button type="button" class="btn btn-warning flex-fill" data-bs-toggle="modal" data-bs-target="#loginModal">
                          <i class="fas fa-sign-in-alt"></i> Login to Book
                      </button>
                  {% endif %}
                {% endif %}

                <!-- Menu Button -->
                {% if restaurant.menu %}
                <button type="button" class="btn btn-outline-primary" 
                        data-bs-toggle="modal" data-bs-target="#menuModal{{ restaurant.id }}"
                        title="View Menu">
                  <i class="fas fa-utensils"></i>
                </button>
                {% endif %}
              </div>
            </div>
          </div>
        </div>

        <!-- Menu Modal -->
        {% if restaurant.menu %}
        <div class="modal fade" id="menuModal{{ restaurant.id }}" tabindex="-1" aria-labelledby="menuModalLabel{{ restaurant.id }}" aria-hidden="true">
          <div class="modal-dialog modal-xl modal-dialog-centered">
            <div class="modal-content">
              <div class="modal-header bg-dark text-white">
                <h5 class="modal-title" id="menuModalLabel{{ restaurant.id }}"><i class="fas fa-book-open me-2"></i>{{ restaurant.name }} - Menu</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body text-center p-2 p-md-3">
                {% if restaurant.menu.url|lower|slice:"-4:" == ".pdf" %}
                  <iframe src="{{ restaurant.menu.url }}"></iframe>
                {% else %}
                  <img src="{{ restaurant.menu.url }}" alt="Menu for {{ restaurant.name }}">
                {% endif %}
              </div>
            </div>
          </div>
        </div>
        {% endif %}
        {% endfor %}
      </div>
    </div>
  </div>

  <!-- Fully booked alert modal -->
  <div class="modal fade" id="fullAlertModal" tabindex="-1" aria-labelledby="fullAlertLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header bg-danger text-white">
          <h5 class="modal-title" id="fullAlertLabel"><i class="fas fa-exclamation-triangle me-2"></i>Seats Full</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body text-center fs-5 py-4">
          <p>Sorry, all seats at <br><strong id="fullRestoName" class="d-block mt-2"></strong><br> are fully booked.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-danger" data-bs-dismiss="modal">OK</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Login required modal -->
  <div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header bg-warning text-dark">
          <h5 class="modal-title" id="loginModalLabel"><i class="fas fa-lock me-2"></i>Login Required</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body text-center fs-5 py-4">
          <p>You need to be logged in to book a table. <br>Please <a href="{% url 'login_page' %}" class="fw-bold">Login</a> or <a href="#" class="fw-bold">Sign Up</a>.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-dark" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    function showFullAlert(name) {
      document.getElementById("fullRestoName").textContent = name;
      const modal = new bootstrap.Modal(document.getElementById("fullAlertModal"));
      modal.show();
    }
  </script>
</body>
</html>